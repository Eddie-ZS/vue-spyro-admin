var ue=Object.defineProperty,ce=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Z=(t,o,p)=>o in t?ue(t,o,{enumerable:!0,configurable:!0,writable:!0,value:p}):t[o]=p,R=(t,o)=>{for(var p in o||(o={}))ge.call(o,p)&&Z(t,p,o[p]);if(Q)for(var p of Q(o))be.call(o,p)&&Z(t,p,o[p]);return t},G=(t,o)=>ce(t,fe(o));import{K as I,bp as K,bq as B,P as c,Q as C,br as me,a4 as he,z as $,bs as ve,I as ye,T as i,aZ as Se,Z as k,y as we,bt as Ce,H as P,J as a,bu as _e,a5 as E,R as v,$ as ee,a9 as te,X as ze,bl as $e,aS as ke,aQ as Pe,aR as Ee,be as Te,bd as Re,bv as De,ag as xe,_ as Be,aA as D,aw as x,bf as z,bw as Ie,a6 as Ue,b9 as je,ba as Le,bx as Ve,by as J,aa as X,aB as H,bz as Y,bA as Me,aI as Ne}from"./.pnpm-D59sYBvj.js";import{p as A,_ as ae}from"./Icon.vue_vue_type_script_lang-EAei3ndZ.js";import{u as O}from"./useIcon-CCOGsOky.js";import{_ as He}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Oe}from"./use-vltj-xWI.js";const Ae=I({__name:"SoPagination",props:K({small:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},background:{type:Boolean,default:!0},layout:{default:"->, total, sizes, prev, pager, next, jumper "},total:{default:0},pageSizes:{default:()=>[10,20,30,40]}},{currentPage:{type:Number,default:1},currentPageModifiers:{},pageSize:{type:Number,default:10},pageSizeModifiers:{}}),emits:K(["getList"],["update:currentPage","update:pageSize"]),setup(t,{emit:o}){const p=o,S=B(t,"currentPage"),m=B(t,"pageSize"),f=r=>{m.value=r,g(1)},g=r=>{S.value=r,p("getList")};return(r,b)=>{const u=me;return c(),C(u,{class:"pt-4","current-page":S.value,"onUpdate:currentPage":b[0]||(b[0]=h=>S.value=h),"page-size":m.value,"onUpdate:pageSize":b[1]||(b[1]=h=>m.value=h),"page-sizes":r.pageSizes,small:r.small,disabled:r.disabled,background:r.background,layout:r.layout,total:r.total,onSizeChange:f,onCurrentChange:g},null,8,["current-page","page-size","page-sizes","small","disabled","background","layout","total"])}}}),Ke=I({name:"SoToolTip",props:{textColor:A.string.def("text-inherit"),content:[String,Number],lineClamp:A.string.def("line-clamp-2"),popoverWidth:A.number.def(230)},setup(t){const{content:o,lineClamp:p,popoverWidth:S,textColor:m}=he(t);let f=$(null),g=$(!1);const r=$(!1);ve(f,([{isIntersecting:u}])=>{r.value=u});const b=()=>{we(()=>{const{offsetHeight:u,scrollHeight:h}=f.value;g.value=h-u>0})};return ye(()=>{r.value&&b()}),()=>i(k,null,[g.value?i(Se,{placement:"top",width:S.value,trigger:"hover"},{default:()=>i("span",null,[o.value]),reference:()=>i("span",{class:`${p.value} ${m.value} leading-23px cursor-pointer`},[o.value])}):i("span",{ref:f,class:`${p.value} leading-23px`},[o.value])])}}),We=I({name:"SoTableTool",props:{showSearch:A.bool.def(!0),columns:{type:Array,default:()=>[]}},emits:["update:show-search","update:columns","refresh"],directives:{draggable:Ce},setup(t,{emit:o}){const p=O({name:"ep:setting",size:12}),S=O({name:"ep:refresh",size:12}),m=O({name:"ep:search",size:12}),f=O({name:"ri:draggable"}),g=P({get:()=>t.showSearch,set:u=>o("update:show-search",u)}),r=P(()=>t.columns);return{showSearch:g,columns:r,Draggable:f,Search:m,Refresh:S,Setting:p,onUpdate:u=>{const[h]=a(r).splice(u.oldIndex,1);a(r).splice(u.newIndex,0,h)}}}}),qe={class:"relative flex flex-justify-end"};function Fe(t,o,p,S,m,f){const g=ze,r=ae,b=$e,u=ke,h=Pe,U=Ee,j=_e("draggable");return c(),E("div",qe,[i(g,{size:"small",circle:"",icon:t.Search,onClick:o[0]||(o[0]=l=>t.showSearch=!t.showSearch)},null,8,["icon"]),i(g,{size:"small",circle:"",icon:t.Refresh,onClick:o[1]||(o[1]=l=>t.$emit("refresh"))},null,8,["icon"]),i(U,{trigger:"click","popper-class":"dropdown-menu",placement:"bottom-end","hide-on-click":!1},{dropdown:v(()=>[ee((c(),C(h,null,{default:v(()=>[(c(!0),E(k,null,te(t.columns,l=>(c(),C(u,{key:l.prop||l.type},{default:v(()=>[i(r,{name:"ri:draggable",class:"handle cursor-move"}),i(b,{modelValue:l.visible,"onUpdate:modelValue":L=>l.visible=L,label:l.label,size:"small"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})),[[j,[t.columns,{animation:200,ghostClass:"ghost",handle:".handle",onUpdate:t.onUpdate}]]])]),default:v(()=>[i(g,{size:"small",class:"ml-3",circle:"",icon:t.Setting},null,8,["icon"])]),_:1})])}const Qe=He(We,[["render",Fe]]),Ze={class:"flex-col flex-1 h-full overflow-hidden"};function Ge(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Ne(t)}const ot=I({__name:"SoTable",props:K({tableData:{default:()=>[]},columnList:{default:()=>[]},rowKey:{default:"id"},height:{},maxHeight:{},border:{type:Boolean,default:!0},pagination:{type:Boolean,default:!0},pageProps:{},tableTool:{type:Boolean,default:!0}},{currentPage:{type:Number},currentPageModifiers:{},pageSize:{type:Number},pageSizeModifiers:{},showSearch:{type:Boolean},showSearchModifiers:{}}),emits:K(["refresh","mount","dragSort"],["update:currentPage","update:pageSize","update:showSearch"]),setup(t,{expose:o,emit:p}){const S=t,m=p,f=Te(),g=Re(),r=$(),b=$({}),u=$("id-"+De()),h=B(t,"currentPage"),U=B(t,"pageSize"),j=B(t,"showSearch"),l=P(()=>{const e=R({},S);return Object.assign(e,a(b)),e}),L=P(()=>(a(l).columnList.forEach(e=>{var s;e.visible=(s=e.visible)!=null?s:!0}),a(l).columnList)),oe=P(()=>{const{pagination:e,pageProps:s}=a(l);return e&&(s==null?void 0:s.total)>0}),ne=P(()=>{const e=R(R({cellStyle:{height:"63px"}},g),a(l));return delete e.tableData,delete e.columnList,delete e.pageProps,delete e.pagination,e}),se=(e={})=>{b.value=Object.assign(a(b),e)},re=(e,s)=>{const{columnList:d}=a(l);d.findIndex(w=>{if(w.prop)return w.prop===e.prop;if(w.type)return w.type===e.type})>-1||(s!==void 0?d.splice(s,0,e):d.push(e))},le=e=>{const{columnList:s}=a(l),d=s.findIndex(y=>y.prop===e||y.type===e);d>-1&&s.splice(d,1)},W=()=>m("refresh"),ie=()=>{Me(`#${u.value} tbody`,$(a(l).tableData),{animation:200,handle:".move",ghostClass:"ghost",onUpdate:({newIndex:e,oldIndex:s})=>{const[d]=a(l).tableData.splice(s,1);a(l).tableData.splice(e,0,d),m("dragSort",{newIndex:e,oldIndex:s})}})},q=e=>{var s;return i(J,z(e,{align:(s=e.align)!=null?s:"center"}),{default:d=>{var w,V,M,n,N,T,_,F;if(e.renderer)return e.renderer(d);if(f[e.prop])return f[e.prop](d);if((w=e.children)!=null&&w.length)return e.children.map(de=>q(de));const y=Oe(((V=e.dictConfig)==null?void 0:V.options)&&((M=e.dictConfig)==null?void 0:M.options())||[],d.row[e.prop],(n=e.dictConfig)==null?void 0:n.value,(N=e.dictConfig)==null?void 0:N.label);return(T=e.tagConfig)!=null&&T.initiate?i(Y,{type:(_=e.tagConfig.type)!=null?_:"primary"},Ge(y)?y:{default:()=>[y]}):i(k,null,[(F=e.overflowConfig)!=null&&F.initiate?i(Ke,{textColor:e.overflowConfig.color,popoverWidth:e.overflowConfig.width,lineClamp:e.overflowConfig.line,content:y},null):y])},header:d=>e.headerRenderer?e.headerRenderer(d):f[`${e.prop}Header`]?f[`${e.prop}Header`](d):e.label})},pe=I({name:"SoTableColumn",props:{column:{type:Object,required:!0}},setup({column:e}){return()=>q(e)}});return xe(()=>a(l).tableData,e=>{e&&ie()}),Be(()=>{var e;m("mount",{soRef:(e=a(r))==null?void 0:e.$parent,elRef:a(r)})}),o({setProps:se,addColumn:re,delColumn:le}),(e,s)=>{const d=je,y=Le,w=ae,V=Ve,M=Ae;return c(),E("div",Ze,[i(y,{justify:"space-between",class:"mb-2"},{default:v(()=>[i(d,{span:1.5},{default:v(()=>[D(e.$slots,"operation")]),_:3}),a(l).tableTool?(c(),C(a(Qe),{key:0,"show-search":j.value,"onUpdate:showSearch":s[0]||(s[0]=n=>j.value=n),columns:a(L),onRefresh:W},null,8,["show-search","columns"])):x("",!0)]),_:3}),i(a(Ie),z({ref_key:"tableRef",ref:r,class:"flex-1",id:a(u),data:a(l).tableData},a(ne)),{append:v(()=>[D(e.$slots,"append")]),empty:v(()=>[i(V,{description:"暂无数据"})]),default:v(()=>[(c(!0),E(k,null,te(a(L),(n,N)=>{var T;return c(),E(k,{key:n},[n.type&&n.visible?(c(),C(a(J),z({key:0},n,{align:(T=n.align)!=null?T:"center","reserve-selection":n.type==="selection"}),{default:v(_=>[n.type==="expand"?(c(),E(k,{key:0},[n.renderer?(c(),C(X(n.renderer),H(z({key:0},_)),null,16)):D(e.$slots,n.type,H(z({key:1},_)))],64)):x("",!0),n.type==="sortable"?(c(),C(a(Y),{key:1,class:"move cursor-move"},{default:v(()=>[i(w,{name:"ep:d-caret",class:"cursor-move!"})]),_:1})):x("",!0)]),header:v(_=>[n.headerRenderer?(c(),C(X(n.headerRenderer),H(z({key:0},_)),null,16)):D(e.$slots,`${n.type}Header`,H(z({key:1},_)))]),_:2},1040,["align","reserve-selection"])):x("",!0),!n.type&&n.prop&&n.visible?(c(),C(a(pe),{key:1,column:G(R({},n),{index:N})},null,8,["column"])):x("",!0)],64)}),128)),D(e.$slots,"default")]),_:3},16,["id","data"]),ee(i(M,z({currentPage:h.value,"onUpdate:currentPage":s[1]||(s[1]=n=>h.value=n),pageSize:U.value,"onUpdate:pageSize":s[2]||(s[2]=n=>U.value=n)},a(l).pageProps,{onGetList:W}),null,16,["currentPage","pageSize"]),[[Ue,a(oe)]])])}}});export{ot as _};
